<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#080808">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>DISTRI EL URU | Tu Mejor Opcion</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        
        :root {
            --bg-main: #080808;
            --bg-card: linear-gradient(145deg, #161616, #0c0c0c);
            --text-main: #e0e0e0;
            --text-muted: #888;
            --border-color: rgba(255, 255, 255, 0.05);
            --accent-color: #ea580c;
            --accent-glow: rgba(234, 88, 12, 0.3);
        }

        * {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            scrollbar-width: none;
        }

        *::-webkit-scrollbar { display: none; }

        body {
            background-color: var(--bg-main);
            color: var(--text-main);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* Animaciones de Tarjetas */
        .product-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            z-index: 1;
        }

        .product-card:hover {
            transform: translateY(-8px) scale(1.02);
            border-color: rgba(234, 88, 12, 0.3);
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            z-index: 10;
        }

        .img-container { perspective: 1000px; }
        .img-container img { transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        .product-card:hover .img-container img { transform: translateZ(30px) rotateY(10deg); }

        /* Skeletons */
        .skeleton {
            background: linear-gradient(90deg, #121212 25%, #1a1a1a 50%, #121212 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite linear;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .badge-pulse { animation: pulse-badge 2s infinite; }
        @keyframes pulse-badge {
            0% { box-shadow: 0 0 0 0 rgba(234, 88, 12, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(234, 88, 12, 0); }
            100% { box-shadow: 0 0 0 0 rgba(234, 88, 12, 0); }
        }

        .fila-check {
            opacity: 0.15;
            filter: grayscale(1) blur(0.5px);
            text-decoration: line-through;
            transition: all 0.3s ease;
        }

        .input-qty-modern { -moz-appearance: textfield; }
        .input-qty-modern::-webkit-outer-spin-button,
        .input-qty-modern::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        @media print {
            .no-print { display: none !important; }
            #modal-logistica { 
                position: absolute !important;
                display: block !important; 
                background: white !important; 
                color: black !important;
                width: 100%;
            }
            .bg-log-table { background: white !important; color: black !important; }
            tr { border-bottom: 1px solid #eee !important; }
        }
    </style>
</head>
<body class="pb-40 selection:bg-orange-500/30">

    <header class="p-6 sticky top-0 z-50 bg-black/80 backdrop-blur-2xl border-b border-white/5 no-print">
        <div class="flex justify-between items-center max-w-7xl mx-auto">
            <div class="flex items-center gap-5">
                <div class="w-16 h-16 bg-orange-600 rounded-[1.8rem] flex items-center justify-center shadow-[0_15px_35px_rgba(234,88,12,0.4)] relative group transition-transform active:scale-90">
                    <i class="fas fa-bolt text-white text-3xl group-hover:animate-pulse"></i>
                    <div class="absolute -bottom-1 -right-1 w-5 h-5 bg-white rounded-full flex items-center justify-center border-4 border-[#080808]">
                        <div id="status-dot" class="w-2 h-2 rounded-full bg-green-500"></div>
                    </div>
                </div>
                <div>
                    <h1 class="text-3xl font-[900] tracking-tighter text-white italic uppercase leading-none">
                        DISTRI EL <span class="text-orange-600">URU</span>
                    </h1>
                    <div class="flex items-center gap-2 mt-2 bg-white/5 px-3 py-1 rounded-full border border-white/5 w-fit">
                        <p id="status-text" class="text-[9px] text-gray-400 uppercase font-black tracking-[0.25em]">Cargando estado...</p>
                    </div>
                </div>
            </div>

            <div class="flex items-center gap-4">
                <button onclick="abrirLogistica()" class="bg-[#121212] p-4 rounded-2xl border border-white/10 hover:bg-orange-600 hover:text-white transition-all shadow-xl group relative">
                    <i class="fas fa-clipboard-list text-orange-500 group-hover:text-white text-xl"></i>
                    <span id="logistics-badge" class="absolute -top-2 -right-2 bg-white text-black text-[10px] font-black px-2 py-0.5 rounded-lg shadow-2xl hidden animate-bounce">0</span>
                </button>
            </div>
        </div>
    </header>

    <div class="p-6 space-y-10 max-w-7xl mx-auto no-print">
        <div class="relative group max-w-4xl mx-auto">
            <div class="absolute inset-y-0 left-7 flex items-center pointer-events-none">
                <i class="fas fa-search text-gray-600 group-focus-within:text-orange-500 transition-colors text-lg"></i>
            </div>
            <input type="text" id="search" oninput="renderCatalogo()" 
                placeholder="Busca marcas, productos o categor√≠as..." 
                class="w-full bg-[#121212] border border-white/5 py-7 pl-16 pr-8 rounded-[3rem] text-sm font-semibold focus:outline-none focus:border-orange-500/50 focus:ring-8 focus:ring-orange-500/5 transition-all shadow-2xl placeholder:text-gray-700 text-white">
            
            <button onclick="document.getElementById('search').value=''; renderCatalogo();" class="absolute right-7 top-1/2 -translate-y-1/2 text-gray-700 hover:text-white transition-colors">
                <i class="fas fa-times-circle"></i>
            </button>
        </div>

        <div class="relative pt-2">
            <div id="categorias" class="flex gap-4 overflow-x-auto pb-6 no-scrollbar items-center scroll-smooth px-2"></div>
            <div class="absolute left-0 top-0 bottom-6 w-12 bg-gradient-to-r from-[#080808] to-transparent pointer-events-none"></div>
            <div class="absolute right-0 top-0 bottom-6 w-12 bg-gradient-to-l from-[#080808] to-transparent pointer-events-none"></div>
        </div>

        <div class="flex justify-between items-center px-4 py-4 border-y border-white/5">
            <div class="flex items-center gap-8">
                <button onclick="toggleSoloFavs()" id="btn-favs" class="text-[10px] font-black uppercase flex items-center gap-3 text-gray-500 hover:text-red-500 transition-all group">
                    <i class="fas fa-heart group-hover:scale-125 transition-transform"></i> 
                    <span>Favoritos</span>
                </button>
                <div class="h-4 w-[1px] bg-white/10"></div>
                <button onclick="abrirHistorial()" class="text-[10px] font-black uppercase flex items-center gap-3 text-gray-500 hover:text-blue-500 transition-all">
                    <i class="fas fa-history"></i> Historial
                </button>
            </div>
            <p id="contador-resultados" class="text-[10px] font-black text-gray-700 uppercase tracking-[0.3em] italic"></p>
        </div>
    </div>

    <main id="catalogo" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-6 p-6 max-w-[1600px] mx-auto min-h-[60vh]"></main>

    <div id="modal-logistica" class="fixed inset-0 z-[100] bg-black/95 backdrop-blur-3xl hidden overflow-y-auto">
        <div class="min-h-screen p-4 md:p-12">
            <div class="max-w-5xl mx-auto">
                <div class="flex justify-between items-center mb-12 no-print">
                    <button onclick="cerrarLogistica()" class="w-14 h-14 flex items-center justify-center bg-white/5 rounded-2xl text-gray-400 hover:text-white hover:bg-white/10 transition-all">
                        <i class="fas fa-arrow-left text-xl"></i>
                    </button>
                    <div class="text-center">
                        <h2 class="font-[900] italic text-3xl uppercase tracking-tighter text-white">Hoja de Carga</h2>
                        <div class="flex items-center justify-center gap-2 mt-1">
                            <span class="w-1.5 h-1.5 rounded-full bg-orange-500 animate-pulse"></span>
                            <p class="text-[10px] text-orange-500 font-black uppercase tracking-[0.4em]">Control de Salida</p>
                        </div>
                    </div>
                    <button onclick="window.print()" class="w-14 h-14 flex items-center justify-center bg-orange-600 rounded-2xl text-white shadow-[0_10px_25px_rgba(234,88,12,0.4)] hover:scale-110 transition-transform">
                        <i class="fas fa-print text-xl"></i>
                    </button>
                </div>
                <div id="cont-tabla-carga" class="bg-[#121212] rounded-[3rem] overflow-hidden border border-white/5 shadow-2xl bg-log-table"></div>
                <div class="mt-10 p-10 border-t border-white/5 text-center no-print">
                    <p class="text-gray-600 text-[10px] font-black uppercase tracking-[0.5em]">Verificar cantidades antes de despachar</p>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-historial" class="fixed inset-0 z-[100] bg-black/90 backdrop-blur-xl hidden overflow-y-auto">
        <div class="min-h-screen p-6 flex items-center justify-center">
            <div class="bg-[#121212] w-full max-w-2xl rounded-[3rem] border border-white/10 p-8 shadow-2xl relative">
                <button onclick="document.getElementById('modal-historial').style.display='none'; document.body.style.overflow='auto';" class="absolute top-6 right-6 text-gray-500 hover:text-white">
                    <i class="fas fa-times-circle text-2xl"></i>
                </button>
                <h3 class="text-2xl font-black italic uppercase text-white mb-6">Tu Historial</h3>
                <div id="lista-historial" class="space-y-4 max-h-[60vh] overflow-y-auto pr-2 no-scrollbar"></div>
            </div>
        </div>
    </div>

    <div id="checkout-bar" class="fixed bottom-8 left-6 right-6 md:left-auto md:right-12 md:w-[450px] bg-white rounded-[3rem] p-5 hidden flex-row items-center gap-5 shadow-[0_25px_70px_rgba(0,0,0,0.7)] z-[80] animate-bounce-in no-print">
        <div class="relative group">
            <div class="bg-orange-600 w-16 h-16 rounded-[2.2rem] flex items-center justify-center text-white shadow-[0_10px_25px_rgba(234,88,12,0.4)] transition-transform group-hover:rotate-12">
                <i class="fas fa-shopping-cart text-2xl"></i>
            </div>
            <span id="cart-count" class="absolute -top-1 -right-1 bg-black text-white text-[11px] font-[900] w-7 h-7 flex items-center justify-center rounded-full border-[3px] border-white shadow-lg">0</span>
        </div>
        <div class="flex-1">
            <p class="text-black/30 text-[9px] font-black uppercase tracking-[0.25em] mb-0.5">Total estimado</p>
            <div class="flex items-baseline gap-1">
                <span id="cart-total" class="text-black text-3xl font-[900] italic tracking-tighter leading-none">$0</span>
                <span class="text-[10px] text-black/20 font-bold uppercase tracking-tighter">ARS</span>
            </div>
        </div>
        <button onclick="sendWhatsApp()" class="bg-black text-white px-8 h-16 rounded-[2.2rem] font-[900] text-[11px] uppercase tracking-tighter hover:bg-gray-800 active:scale-95 transition-all flex items-center gap-3">
            PEDIR <i class="fab fa-whatsapp text-xl text-green-500"></i>
        </button>
    </div>

    <script>
    const TSV_SOURCE = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS-o6GvXN9X2t_o6YQ9E6J_fF-Gz0X_xV_vL1A_Y0Z_H3Z7X_XzX/pub?output=tsv';
    let rawData = [];
    let cart = JSON.parse(localStorage.getItem('cart_uru_v3')) || {};
    let favoritos = JSON.parse(localStorage.getItem('favs_uru_v3')) || [];
    let historial = JSON.parse(localStorage.getItem('hist_uru_v3')) || [];
    let activeCat = 'TODOS';
    let soloFavs = false;

    async function loadEngine() {
        try {
            const response = await fetch(`${TSV_SOURCE}&t=${new Date().getTime()}`);
            const tsvText = await response.text();
            const rows = tsvText.split(/\r?\n/).slice(1);
            
            rawData = rows.map((line, idx) => {
                const col = line.split('\t');
                const priceValue = (col[1] || '').trim().replace(/[$\s]/g, '').replace(',', '.');
                const priceNum = parseFloat(priceValue) || 0;
                const priceFloor = Math.floor(priceNum);
                const isNew = priceNum === (priceFloor + 0.01) || (col[1]||'').endsWith('1');
                const isOffer = priceNum === (priceFloor + 0.99) || (col[1]||'').endsWith('99');

                return {
                    id: idx,
                    nombre: (col[0] || 'Producto sin nombre').trim(),
                    precio: priceNum,
                    categoria: (col[2] || 'VARIOS').trim().toUpperCase(),
                    imagen: (col[3] || '').trim(),
                    stock: priceNum > 0 ? 9999 : 0,
                    esNuevo: isNew,
                    esOferta: isOffer,
                    precioSugerido: (col[5] || '').trim(),
                    packCant: parseInt(col[6]) || 0,
                    packPrecio: parseFloat((col[7] || '0').replace(',', '.')) || 0
                };
            }).filter(item => item.nombre.length > 2);

            rawData.sort((a, b) => a.nombre.localeCompare(b.nombre));
            renderCategories();
            renderCatalogo();
            updateUI();
            checkOpenStatus();
            renderHistorial();
        } catch (error) {
            handleLoadingError();
        }
    }

    function renderCategories() {
        const categories = ['TODOS', ...new Set(rawData.map(p => p.categoria))];
        const container = document.getElementById('categorias');
        container.innerHTML = categories.map(cat => `
            <button onclick="filterByCategory('${cat}')" 
                class="category-btn px-8 py-5 rounded-[1.8rem] text-[10px] font-black uppercase whitespace-nowrap transition-all duration-300 border
                ${activeCat === cat ? 'bg-orange-600 text-white border-orange-500 shadow-xl scale-105 z-10' : 'bg-[#121212] text-gray-600 border-white/5'}">
                ${cat}
            </button>
        `).join('');
    }

    function filterByCategory(cat) {
        activeCat = cat;
        renderCategories();
        renderCatalogo();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function renderCatalogo() {
        const query = document.getElementById('search').value.toLowerCase();
        const catalogo = document.getElementById('catalogo');
        const contador = document.getElementById('contador-resultados');
        
        let filtered = rawData.filter(p => {
            const coincideCategoria = activeCat === 'TODOS' || p.categoria === activeCat;
            const coincideBusqueda = p.nombre.toLowerCase().includes(query) || p.categoria.toLowerCase().includes(query);
            return coincideCategoria && coincideBusqueda;
        });

        if (soloFavs) filtered = filtered.filter(p => favoritos.includes(p.id));
        if (contador) contador.innerText = `${filtered.length} ART√çCULOS ENCONTRADOS`;

        if (filtered.length === 0) {
            catalogo.innerHTML = `<div class="col-span-full py-20 text-center"><p class="text-gray-500 font-bold uppercase">No se encontraron productos</p></div>`;
            return;
        }

        catalogo.innerHTML = filtered.map(p => {
            const cantidad = cart[p.id] || 0;
            const esAgotado = p.stock <= 0;
            const esFav = favoritos.includes(p.id);

            return `
                <div class="product-card p-6 rounded-[2.8rem] flex flex-col ${esAgotado ? 'opacity-40 grayscale-[0.5]' : ''}">
                    <div class="absolute top-6 right-6 z-20 flex flex-col gap-2 items-end">
                        ${esAgotado ? `<span class="bg-red-600 text-white text-[8px] font-[900] px-3 py-1.5 rounded-lg uppercase">Sin Stock</span>` : ''}
                        ${p.esNuevo && !esAgotado ? `<span class="bg-blue-600 text-white text-[9px] font-[900] px-3 py-1.5 rounded-lg badge-pulse uppercase">Nuevo ‚ú®</span>` : ''}
                        ${p.esOferta && !esAgotado ? `<span class="bg-orange-600 text-white text-[9px] font-[900] px-3 py-1.5 rounded-lg badge-pulse uppercase">Oferta üî•</span>` : ''}
                    </div>
                    <button onclick="toggleFavorito(${p.id})" class="absolute top-6 left-6 z-20 w-10 h-10 flex items-center justify-center rounded-full bg-black/20 backdrop-blur-md border border-white/5 transition-all ${esFav ? 'text-red-600' : 'text-gray-600 hover:text-white'}">
                        <i class="${esFav ? 'fas' : 'far'} fa-heart"></i>
                    </button>
                    <div class="img-container h-44 mb-6 flex items-center justify-center p-4 relative mt-4">
                        <div class="skeleton absolute inset-10 rounded-full opacity-10" id="loader-img-${p.id}"></div>
                        <img src="${p.imagen}" class="max-h-full max-w-full object-contain" onload="document.getElementById('loader-img-${p.id}').style.display='none'" onerror="this.src='https://i.ibb.co/yB7ffL4T/unnamed.jpg'; this.classList.add('opacity-20'); document.getElementById('loader-img-${p.id}').style.display='none'">
                    </div>
                    <div class="flex-1 flex flex-col justify-end">
                        <h3 class="text-[10px] font-black uppercase text-gray-400 italic mb-3 line-clamp-2">${p.nombre}</h3>
                        <div class="flex items-end justify-between gap-2 mb-4">
                            <div>
                                <p class="text-white/30 text-[8px] font-black uppercase mb-1">Precio Unitario</p>
                                <p class="text-3xl font-[900] text-white italic tracking-tighter leading-none">${esAgotado ? '<span class="text-gray-800">CONSULTAR</span>' : `<span class="text-sm font-bold">$</span>${p.precio.toLocaleString('es-AR')}`}</p>
                            </div>
                            ${p.precioSugerido && !esAgotado ? `<div class="text-right"><p class="text-[8px] text-gray-600 font-black uppercase">Sugerido</p><p class="text-[11px] text-orange-500/50 font-black italic">$${p.precioSugerido}</p></div>` : ''}
                        </div>
                        ${p.packCant > 0 && !esAgotado ? `<div class="bg-green-500/5 border border-green-500/10 p-3 rounded-2xl mb-4"><p class="text-[9px] text-green-500 font-black uppercase flex items-center gap-2"><i class="fas fa-box-open"></i> Pack x${p.packCant}: $${p.packPrecio.toLocaleString('es-AR')} c/u</p></div>` : ''}
                    </div>
                    <div class="mt-auto">
                        ${esAgotado ? `<button disabled class="w-full bg-[#161616] py-5 rounded-[1.5rem] font-black text-[10px] text-gray-700 uppercase">Reingresar√° Pronto</button>` : 
                        (cantidad === 0 ? `<button onclick="addToCart(${p.id}, 1)" class="w-full bg-orange-600 hover:bg-orange-500 py-5 rounded-[1.5rem] font-black text-[11px] text-white uppercase shadow-lg transition-all active:scale-95 flex items-center justify-center gap-3"><i class="fas fa-plus-circle"></i> Agregar</button>` : 
                        `<div class="flex items-center bg-orange-600 rounded-[1.5rem] p-1.5 shadow-2xl"><button onclick="addToCart(${p.id}, -1)" class="w-12 h-12 flex items-center justify-center text-white text-xl font-black rounded-xl">Ôºç</button><input type="number" value="${cantidad}" class="input-qty-modern flex-1 bg-transparent text-center text-white font-[900] text-xl outline-none" onchange="manualCartEntry(${p.id}, this.value)" onclick="this.select()"><button onclick="addToCart(${p.id}, 1)" class="w-12 h-12 flex items-center justify-center text-white text-xl font-black rounded-xl">Ôºã</button></div>`)}
                    </div>
                </div>
            `;
        }).join('');
    }

    function addToCart(id, delta) {
        const actual = cart[id] || 0;
        updateCartQuantity(id, actual + delta);
    }

    function manualCartEntry(id, value) {
        updateCartQuantity(id, parseInt(value) || 0);
    }

    function updateCartQuantity(id, quantity) {
        const producto = rawData.find(p => p.id == id);
        if (!producto || producto.stock <= 0) { delete cart[id]; }
        else if (quantity <= 0) { delete cart[id]; }
        else { cart[id] = Math.min(quantity, producto.stock); }
        localStorage.setItem('cart_uru_v3', JSON.stringify(cart));
        updateUI();
        renderCatalogo();
    }

    function updateUI() {
        const totalItems = Object.values(cart).reduce((a, b) => a + b, 0);
        let montoTotal = 0;
        Object.entries(cart).forEach(([id, q]) => {
            const p = rawData.find(item => item.id == id);
            if (p) {
                if (p.packCant > 0 && q >= p.packCant) montoTotal += p.packPrecio * q;
                else montoTotal += p.precio * q;
            }
        });

        const bar = document.getElementById('checkout-bar');
        if (bar) {
            if (totalItems > 0) { bar.classList.remove('hidden'); bar.classList.add('flex'); }
            else { bar.classList.add('hidden'); bar.classList.remove('flex'); }
        }
        document.getElementById('cart-count').innerText = totalItems;
        document.getElementById('cart-total').innerText = '$' + montoTotal.toLocaleString('es-AR');
        document.getElementById('logistics-badge').innerText = totalItems;
        document.getElementById('logistics-badge').classList.toggle('hidden', totalItems === 0);
    }

    function toggleFavorito(id) {
        const index = favoritos.indexOf(id);
        if (index > -1) favoritos.splice(index, 1);
        else {
            favoritos.push(id);
            confetti({ particleCount: 40, spread: 60, origin: { x: 0.5, y: 0.85 }, colors: ['#ea580c', '#ffffff'] });
        }
        localStorage.setItem('favs_uru_v3', JSON.stringify(favoritos));
        renderCatalogo();
    }

    function toggleSoloFavs() {
        soloFavs = !soloFavs;
        document.getElementById('btn-favs').classList.toggle('text-red-500');
        renderCatalogo();
    }

    function sendWhatsApp() {
        const items = Object.entries(cart);
        if (items.length === 0) return;
        let totalGeneral = 0;
        let listaNombres = [];
        let msg = "üöÄ *NUEVO PEDIDO - DISTRI EL URU*\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
        
        items.forEach(([id, q]) => {
            const p = rawData.find(item => item.id == id);
            if (p) {
                let precioAplicado = (p.packCant > 0 && q >= p.packCant) ? p.packPrecio : p.precio;
                let subtotal = precioAplicado * q;
                totalGeneral += subtotal;
                listaNombres.push(`${q}x ${p.nombre}`);
                msg += `üì¶ *${p.nombre}*\n   ‚û§ Cant: ${q}u.\n   ‚û§ Unit: $${precioAplicado.toLocaleString('es-AR')}\n   ‚û§ *Subtotal: $${subtotal.toLocaleString('es-AR')}*\n\n`;
            }
        });

        msg += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüí∞ *TOTAL: $${totalGeneral.toLocaleString('es-AR')}*\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`;
        
        const histItem = { id: Date.now(), fecha: new Date().toLocaleString(), items: listaNombres.join(', '), total: totalGeneral };
        historial.unshift(histItem);
        if (historial.length > 10) historial.pop();
        localStorage.setItem('hist_uru_v3', JSON.stringify(historial));
        
        confetti({ particleCount: 180, spread: 80, origin: { y: 0.6 }, colors: ['#ea580c', '#ffffff', '#22c55e'] });
        setTimeout(() => { window.open(`https://wa.me/5491136357428?text=${encodeURIComponent(msg)}`, '_blank'); }, 800);
    }

    function abrirLogistica() {
        const items = Object.entries(cart);
        if (items.length === 0) {
            Swal.fire({ title: 'Carrito Vac√≠o', icon: 'info', background: '#121212', color: '#fff' });
            return;
        }
        let html = `<div class="overflow-x-auto"><table class="w-full text-left border-collapse"><thead><tr class="text-orange-500 uppercase text-[10px]">
            <th class="p-8 border-b border-white/5">Producto</th><th class="p-8 border-b border-white/5 text-center">Cant</th><th class="p-8 border-b border-white/5 text-center no-print">Check</th></tr></thead><tbody>`;
        
        items.forEach(([id, q]) => {
            const p = rawData.find(prod => prod.id == id);
            if (p) {
                html += `<tr id="row-log-${id}" class="transition-all"><td class="p-8 text-white font-black uppercase text-sm italic">${p.nombre}</td>
                <td class="p-8 text-center"><div class="inline-flex bg-orange-600 text-white w-14 h-14 rounded-2xl items-center justify-center font-black text-2xl">${q}</div></td>
                <td class="p-8 text-center no-print"><input type="checkbox" onchange="document.getElementById('row-log-${id}').classList.toggle('fila-check')" class="w-10 h-10 accent-orange-600"></td></tr>`;
            }
        });
        document.getElementById('cont-tabla-carga').innerHTML = html + `</tbody></table></div>`;
        document.getElementById('modal-logistica').style.display = 'block';
        document.body.style.overflow = 'hidden';
    }

    function cerrarLogistica() { document.getElementById('modal-logistica').style.display = 'none'; document.body.style.overflow = 'auto'; }

    function abrirHistorial() {
        renderHistorial();
        document.getElementById('modal-historial').style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    function renderHistorial() {
        const cont = document.getElementById('lista-historial');
        if (historial.length === 0) { cont.innerHTML = `<p class="text-gray-600 text-center py-10 italic">Sin pedidos.</p>`; return; }
        cont.innerHTML = historial.map(h => `
            <div class="bg-white/5 border border-white/5 p-5 rounded-2xl mb-3">
                <div class="flex justify-between mb-2"><span class="text-[10px] text-orange-500 font-black">${h.fecha}</span><span class="text-white font-black">$${h.total.toLocaleString('es-AR')}</span></div>
                <p class="text-[9px] text-gray-500 truncate">${h.items}</p>
            </div>
        `).join('');
    }

    function checkOpenStatus() {
        const hour = new Date().getHours();
        const isOpen = (hour >= 8 && hour < 20);
        document.getElementById('status-dot').className = `w-2 h-2 rounded-full ${isOpen ? 'bg-green-500' : 'bg-red-600'}`;
        document.getElementById('status-text').innerText = isOpen ? "Abierto ahora ‚Ä¢ Tomando pedidos" : "Cerrado ‚Ä¢ Abrimos 08:00 AM";
    }

    function handleLoadingError() {
        Swal.fire({ title: 'Error de Conexi√≥n', text: 'No pudimos cargar los precios.', icon: 'warning', background: '#121212', color: '#fff' });
    }

    document.addEventListener('DOMContentLoaded', loadEngine);
    setInterval(checkOpenStatus, 60000);
    </script>
</body>
</html>
