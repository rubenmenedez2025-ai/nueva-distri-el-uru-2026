<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>Distri El Uru | Premium</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .btn-active { 
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%) !important;
            color: white !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); }
        .banner-gradient { background: linear-gradient(90deg, #1e3a8a 0%, #1e40af 100%); }
        input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; }
        .product-card:hover img { transform: scale(1.05); }
    </style>
</head>
<body class="bg-slate-100 font-sans text-slate-900">

    <div class="banner-gradient text-white py-2 overflow-hidden whitespace-nowrap relative z-[60]">
        <div class="flex animate-marquee gap-8 font-bold text-[10px] uppercase tracking-[0.2em]">
            <span>üöö Entregas r√°pidas en Viedma y Patagones üöö</span>
            <span>üî• Ofertas exclusivas por tiempo limitado üî•</span>
            <span>üçª Los mejores precios de la regi√≥n üçª</span>
            <span>üöö Entregas r√°pidas en Viedma y Patagones üöö</span>
        </div>
    </div>

    <nav class="glass border-b border-white sticky top-0 z-50 p-4 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <div class="relative">
                <img src="https://i.ibb.co/YFrS7z8/logo-uru.png" class="w-12 h-12 rounded-full border-2 border-blue-900 shadow-md object-cover bg-white">
                <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 border-2 border-white rounded-full"></div>
            </div>
            <div>
                <h1 class="font-black text-xl tracking-tighter italic text-blue-900 leading-none">EL URU</h1>
                <p class="text-[9px] font-bold text-slate-400">MAYORISTA DISTRIBUIDORA</p>
            </div>
        </div>
        <button onclick="document.getElementById('cart-modal').style.display='flex'" class="relative bg-blue-900 text-white p-3 rounded-2xl shadow-lg active:scale-90 transition-all">
            <i class="fas fa-shopping-bag text-xl"></i>
            <span id="cart-count" class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-bold rounded-full w-5 h-5 flex items-center justify-center border-2 border-white shadow-sm">0</span>
        </button>
    </nav>

    <div class="p-6 max-w-4xl mx-auto">
        <div class="relative group">
            <input type="text" id="search" placeholder="¬øQu√© llevamos hoy?" onkeyup="renderProducts()" 
                class="w-full pl-12 pr-4 py-4 rounded-3xl border-none shadow-xl outline-none focus:ring-2 focus:ring-blue-500 bg-white transition-all text-sm">
            <i class="fas fa-search absolute left-5 top-1/2 -translate-y-1/2 text-slate-300 group-focus-within:text-blue-500 transition-colors"></i>
        </div>
    </div>

    <div class="px-4 mb-6">
        <div id="category-filters" class="flex gap-3 overflow-x-auto pb-4 no-scrollbar"></div>
    </div>

    <main id="catalogo" class="p-4 container mx-auto grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 pb-28"></main>

    <div id="cart-modal" style="display:none;" class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-[100] justify-end overflow-hidden">
        <div class="bg-white w-full max-w-md h-full flex flex-col shadow-2xl">
            <div class="p-6 bg-slate-50 border-b flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-black text-blue-900">MI PEDIDO</h2>
                    <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Revisa tus productos</p>
                </div>
                <button onclick="document.getElementById('cart-modal').style.display='none'" class="w-10 h-10 rounded-full bg-white shadow-sm flex items-center justify-center text-slate-400 hover:text-red-500 transition-colors">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="cart-items" class="flex-1 overflow-y-auto p-6 space-y-4"></div>
            <div class="p-6 bg-slate-50 border-t space-y-4">
                <div class="flex justify-between items-center">
                    <span class="text-slate-400 font-bold text-sm">TOTAL ESTIMADO</span>
                    <span class="text-3xl font-black text-blue-900">$<span id="cart-total">0</span></span>
                </div>
                <button onclick="sendWhatsApp()" class="w-full bg-green-500 hover:bg-green-600 text-white py-5 rounded-3xl font-black text-lg shadow-xl shadow-green-200 flex items-center justify-center gap-3 transition-all active:scale-95">
                    <i class="fab fa-whatsapp text-2xl"></i> CONFIRMAR PEDIDO
                </button>
            </div>
        </div>
    </div>

    <script>
        const TSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQEemzCvTezcjzZhIUIRIayZ7U81xgssl9G1Vr6Odx7dHGHOARY0iJ-VOL43E17qLVkiIRb0LTurcZU/pub?output=tsv';
        const WHATSAPP_NUMBER = "5492920248292";
        
        let productos = [];
        let cart = {};
        let activeCategory = 'TODOS';

        async function loadData() {
            try {
                const response = await fetch(TSV_URL + '&cache=' + new Date().getTime());
                const text = await response.text();
                const lines = text.split(/\r?\n/).filter(l => l.trim() !== "");
                productos = lines.slice(1).map((line, index) => {
                    const cols = line.split('\t');
                    return {
                        id: index,
                        nombre: (cols[0] || "").replace(/"/g, "").trim(),
                        precio: parseInt((cols[1] || "0").replace(/[^0-9]/g, "")) || 0,
                        categoria: (cols[2] || "GENERAL").replace(/"/g, "").trim().toUpperCase(),
                        imagen: (cols[3] || "").replace(/"/g, "").trim()
                    };
                }).filter(p => p.nombre !== "");
                renderCategories();
                renderProducts();
            } catch (e) { console.error(e); }
        }

        function renderCategories() {
            const listadoCats = ['TODOS', ...new Set(productos.map(p => p.categoria))];
            document.getElementById('category-filters').innerHTML = listadoCats.map(cat => `
                <button onclick="filterByCat('${cat}')" class="whitespace-nowrap px-8 py-3 rounded-2xl bg-white text-slate-500 font-bold text-xs shadow-sm border border-transparent transition-all hover:bg-slate-50 ${activeCategory === cat ? 'btn-active' : ''}">${cat}</button>
            `).join('');
        }

        window.filterByCat = (cat) => { activeCategory = cat; renderCategories(); renderProducts(); }

        function renderProducts() {
            const term = document.getElementById('search').value.toLowerCase();
            const container = document.getElementById('catalogo');
            const filtrados = productos.filter(p => (activeCategory === 'TODOS' || p.categoria === activeCategory) && p.nombre.toLowerCase().includes(term));

            container.innerHTML = filtrados.map(p => {
                const q = cart[p.id] ? cart[p.id].cant : 0;
                const isPromo = p.precio.toString().endsWith('99');
                return `
                <div class="product-card bg-white p-4 rounded-[2rem] shadow-sm border border-white hover:shadow-xl transition-all duration-300 flex flex-col group relative">
                    ${isPromo ? `<div class="absolute top-4 left-4 z-10 bg-red-500 text-white text-[8px] font-black px-2 py-1 rounded-full shadow-lg animate-pulse">OFERTA üî•</div>` : ''}
                    <div class="h-32 w-full mb-4 flex items-center justify-center overflow-hidden rounded-2xl">
                        <img src="${p.imagen}" class="max-h-full max-w-full object-contain transition-transform duration-500" onerror="this.src='https://via.placeholder.com/150'">
                    </div>
                    <div class="flex-1">
                        <span class="text-[8px] font-black text-blue-400 tracking-widest uppercase">${p.categoria}</span>
                        <h3 class="text-[11px] font-black text-slate-700 leading-tight uppercase h-8 overflow-hidden mt-1 group-hover:text-blue-900 transition-colors">${p.nombre}</h3>
                        <p class="text-blue-900 font-black text-xl mt-2 italic">$${p.precio.toLocaleString('es-AR')}</p>
                    </div>
                    <div class="mt-4 flex gap-1 items-center bg-slate-50 p-1.5 rounded-2xl border border-slate-100">
                        ${q > 0 ? `
                            <button onclick="changeQty(${p.id}, -1)" class="w-10 h-10 bg-white text-slate-400 rounded-xl font-black shadow-sm active:scale-90">-</button>
                            <input type="number" step="0.1" value="${q}" onchange="manualQty(${p.id}, this.value)" class="flex-1 w-8 text-center bg-transparent font-black text-blue-900 text-sm outline-none">
                            <button onclick="changeQty(${p.id}, 1)" class="w-10 h-10 bg-blue-600 text-white rounded-xl font-black shadow-lg active:scale-90">+</button>
                        ` : `
                            <button onclick="changeQty(${p.id}, 1)" class="w-full bg-slate-900 text-white py-3.5 rounded-xl font-black text-[10px] uppercase tracking-[0.1em] shadow-lg active:scale-95 transition-all">Agregar</button>
                        `}
                    </div>
                </div>`;
            }).join('');
        }

        window.changeQty = function(id, delta) {
            if (!cart[id]) {
                const p = productos[id];
                cart[id] = { nombre: p.nombre, precio: p.precio, cant: 0, imagen: p.imagen };
            }
            cart[id].cant = Math.max(0, Math.round((cart[id].cant + delta) * 10) / 10);
            if (cart[id].cant <= 0) delete cart[id];
            updateCartUI();
            renderProducts();
        };

        window.manualQty = function(id, val) {
            const num = parseFloat(val);
            if (isNaN(num) || num <= 0) { delete cart[id]; } 
            else { cart[id].cant = num; }
            updateCartUI();
            renderProducts();
        };

        window.removeItem = (id) => { delete cart[id]; updateCartUI(); renderProducts(); }

        function updateCartUI() {
            const items = Object.entries(cart);
            let total = 0, count = 0;
            document.getElementById('cart-items').innerHTML = items.map(([id, i]) => {
                total += (i.precio * i.cant);
                count += i.cant;
                return `
                <div class="flex items-center gap-4 bg-slate-50 p-4 rounded-3xl border border-white shadow-sm">
                    <img src="${i.imagen}" class="w-12 h-12 object-contain" onerror="this.src='https://via.placeholder.com/50'">
                    <div class="flex-1">
                        <h4 class="font-black text-slate-700 uppercase text-[10px] leading-none mb-1">${i.nombre}</h4>
                        <div class="flex items-center gap-2">
                            <span class="text-[10px] font-bold text-blue-600 px-2 py-0.5 bg-blue-50 rounded-lg">${i.cant} UN.</span>
                            <span class="text-[10px] text-slate-400 font-bold">$${i.precio.toLocaleString('es-AR')}</span>
                        </div>
                    </div>
                    <div class="flex flex-col items-end">
                        <span class="font-black text-blue-900 text-sm">$${(i.precio * i.cant).toLocaleString('es-AR')}</span>
                        <button onclick="removeItem(${id})" class="text-red-400 hover:text-red-600 p-2"><i class="fas fa-trash-alt"></i></button>
                    </div>
                </div>`;
            }).join('') || '<div class="text-center py-20 text-slate-300 font-bold italic tracking-widest uppercase">Carrito Vac√≠o</div>';
            document.getElementById('cart-total').innerText = total.toLocaleString('es-AR');
            document.getElementById('cart-count').innerText = Math.round(count * 10) / 10;
        }

        function sendWhatsApp() {
            const items = Object.values(cart);
            if (!items.length) return;
            let msg = "*NUEVO PEDIDO - DISTRI EL URU*%0A%0A";
            items.forEach(i => msg += `‚úÖ *${i.cant}* x ${i.nombre} ($${(i.precio*i.cant).toLocaleString('es-AR')})%0A`);
            msg += "%0A*TOTAL ESTIMADO: $" + document.getElementById('cart-total').innerText + "*";
            window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${msg}`);
        }
        loadData();
    </script>

    <style>
        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        .animate-marquee {
            animation: marquee 20s linear infinite;
        }
    </style>
</body>
</html>